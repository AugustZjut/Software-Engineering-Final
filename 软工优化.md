ä¼˜åŒ–äº‹é¡¹ï¼š

# ç§èŠå®ç°

è¿™æ˜¯ä¸€ä¸ªåŸºäº **Spring Boot + WebSocket + MySQL** çš„å®Œæ•´å®ç°æ–¹æ¡ˆã€‚æˆ‘ä»¬å°†é‡‡ç”¨**â€œåŒå†™Inboxæ¨¡å¼â€**æ¥å¤„ç†ä¼šè¯åˆ—è¡¨ï¼Œå¹¶ç»“åˆ**â€œå‰ç«¯è·¯ç”±ä¼˜å…ˆ + åç«¯æ•°æ®æŒä¹…åŒ–â€**çš„ç­–ç•¥æ¥å¤„ç†å•†å“ä¸Šä¸‹æ–‡ã€‚

------

### ä¸€ã€ æ•°æ®åº“è®¾è®¡ (Schema Design)

æ ¸å¿ƒåœ¨äºæ‹†åˆ†â€œä¼šè¯åˆ—è¡¨â€ä¸â€œæ¶ˆæ¯è®°å½•â€ï¼Œå¹¶åˆ©ç”¨ JSON å­—æ®µç¡®ä¿å­˜å‚¨çµæ´»æ€§ã€‚

#### 1. æ ¸å¿ƒè¡¨ç»“æ„

SQL

```
-- 1. ä¼šè¯åˆ—è¡¨è¡¨ (chat_conversations)
-- é‡‡ç”¨"å†™æ‰©æ•£"æ¨¡å¼ï¼šAå’ŒBèŠå¤©ï¼Œè¡¨é‡Œæœ‰ä¸¤è¡Œè®°å½•(Aå­˜ä¸€è¡Œï¼ŒBå­˜ä¸€è¡Œ)
CREATE TABLE `chat_conversations` (
    `id` BIGINT PRIMARY KEY AUTO_INCREMENT,
    `owner_id` BIGINT NOT NULL COMMENT 'åˆ—è¡¨æ‰€æœ‰è€…ID',
    `peer_id` BIGINT NOT NULL COMMENT 'èŠå¤©å¯¹è±¡ID',
    
    -- [å…³é”®] ä¸Šä¸‹æ–‡ç»‘å®šå­—æ®µï¼šå†³å®šåˆ—è¡¨é¡µæ˜¾ç¤º"åœ¨èŠ: iPhone 13"
    `related_product_id` BIGINT COMMENT 'å½“å‰å…³è”å•†å“ID',
    `related_product_info` JSON COMMENT 'å•†å“å¿«ç…§(å­˜æ ‡é¢˜/å›¾ç‰‡ï¼Œé¿å…æŸ¥è¡¨)',
    
    `last_msg_content` VARCHAR(255) COMMENT 'æœ€åä¸€æ¡æ¶ˆæ¯é¢„è§ˆ',
    `last_msg_time` DATETIME COMMENT 'æ’åºç”¨',
    `unread_count` INT DEFAULT 0 COMMENT 'æœªè¯»æ•°',
    
    UNIQUE KEY `uk_owner_peer` (`owner_id`, `peer_id`), -- å”¯ä¸€çº¦æŸï¼šä¸¤äººåªæœ‰ä¸€ä¸ªä¼šè¯
    INDEX `idx_owner_time` (`owner_id`, `last_msg_time`) -- åˆ—è¡¨æŸ¥è¯¢ä¼˜åŒ–
);

-- 2. æ¶ˆæ¯è®°å½•è¡¨ (chat_messages)
CREATE TABLE `chat_messages` (
    `id` BIGINT PRIMARY KEY AUTO_INCREMENT,
    `sender_id` BIGINT NOT NULL,
    `receiver_id` BIGINT NOT NULL,
    
    -- 0:æ–‡æœ¬, 1:å›¾ç‰‡, 2:å•†å“å¡ç‰‡, 3:ç³»ç»Ÿ/è®¢å•é€šçŸ¥
    `msg_type` TINYINT DEFAULT 0, 
    `content` TEXT,
    
    -- [å…³é”®] æ‰©å±•å­—æ®µï¼šå­˜å•†å“å¡ç‰‡è¯¦æƒ…ã€è®¢å•çŠ¶æ€ç­‰
    -- æ ¼å¼: {"productId":101, "price":500, "title":"..."}
    `extra_data` JSON, 
    
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

------

### äºŒã€ ä¸šåŠ¡ç”¨ä¾‹ (Use Case)

**åœºæ™¯ï¼š** ç”¨æˆ· **August (ä¹°å®¶)** æƒ³è¦è´­ä¹° **Seller (å–å®¶)** çš„ä¸€å° **"iPhone 13" (ID: 5001)**ã€‚

#### æµç¨‹æ¦‚è§ˆï¼š

1. **è¿›åœº**ï¼šAugust ä»è¯¦æƒ…é¡µç‚¹å‡»â€œç§èŠâ€ã€‚
2. **å±•ç¤º**ï¼šèŠå¤©é¡µé¡¶éƒ¨å‡ºç°â€œiPhone 13â€æ‚¬æµ®æ¡ã€‚
3. **å‘é€**ï¼šAugust å‘é€â€œè¿˜åœ¨å—ï¼Ÿâ€ï¼Œç³»ç»Ÿè‡ªåŠ¨ç»‘å®šä¸Šä¸‹æ–‡ã€‚
4. **åˆ—è¡¨**ï¼šSeller æ”¶åˆ°æ¶ˆæ¯ï¼Œåˆ—è¡¨é¡µæ˜¾ç¤º August åœ¨é—®â€œiPhone 13â€ã€‚
5. **åˆ‡æ¢**ï¼šAugust åæ¥åˆå»çœ‹äº†å–å®¶çš„â€œMacBookâ€ï¼Œç‚¹å‡»ç§èŠï¼Œæ‚¬æµ®æ¡è‡ªåŠ¨åˆ‡æ¢ã€‚

------

### ä¸‰ã€ å…¨æµç¨‹æ·±åº¦åˆ†æ

#### é˜¶æ®µ 1ï¼šè¿›å…¥èŠå¤© (Context Injection)

- **å‰ç«¯**ï¼šAugust ç‚¹å‡»æŒ‰é’®ï¼Œè·¯ç”±è·³è½¬ `/chat?targetId=Seller&productId=5001`ã€‚
- **æ¸²æŸ“é€»è¾‘**ï¼š
  - å‰ç«¯æ£€æµ‹åˆ° URL å¸¦ `productId=5001`ã€‚
  - **å¿½ç•¥**æ•°æ®åº“é‡Œå¯èƒ½çš„æ—§å…³è”ï¼Œå¼ºåˆ¶è°ƒç”¨ API è·å– ID ä¸º 5001 çš„å•†å“ä¿¡æ¯ã€‚
  - æ¸²æŸ“é¡¶éƒ¨ **[å•†å“æ‚¬æµ®æ¡]**ã€‚
- **æ³¨æ„**ï¼šæ­¤æ—¶**ä¸è°ƒç”¨**åç«¯ä¿®æ”¹æ•°æ®åº“ï¼Œä»…å‰ç«¯å±•ç¤ºã€‚

#### é˜¶æ®µ 2ï¼šå‘é€æ¶ˆæ¯ (Context Persistence)

- **å‰ç«¯**ï¼šAugust è¾“å…¥â€œè¿˜èƒ½ä¾¿å®œå—â€ï¼Œç‚¹å‡»å‘é€ã€‚

- **Socket payload**ï¼š

  JSON

  ```
  {
    "to": "Seller",
    "type": 0, // æ–‡æœ¬
    "content": "è¿˜èƒ½ä¾¿å®œå—",
    "currentProductId": 5001 // [å…³é”®] å¸¦ä¸Šå½“å‰çš„ä¸Šä¸‹æ–‡
  }
  ```

- **åç«¯å¤„ç†**ï¼š

  1. å­˜å…¥ `chat_messages`ã€‚
  2. æ›´æ–° **August** çš„ä¼šè¯è¡¨ï¼šæ›´æ–° `last_msg`ï¼ŒåŒæ—¶æ›´æ–° `related_product_id = 5001`ã€‚
  3. æ›´æ–° **Seller** çš„ä¼šè¯è¡¨ï¼šæ›´æ–° `last_msg`ï¼Œ`unread_count + 1`ï¼ŒåŒæ—¶æ›´æ–° `related_product_id = 5001`ã€‚

#### é˜¶æ®µ 3ï¼šæŸ¥çœ‹åˆ—è¡¨ (List View)

- **Seller ç«¯**ï¼šæ‰“å¼€æ¶ˆæ¯åˆ—è¡¨ã€‚
- **å‰ç«¯**ï¼šæ¸²æŸ“åˆ—è¡¨é¡¹ã€‚è¯»å– `related_product_id`ï¼Œåœ¨å¤´åƒæ—æ˜¾ç¤ºæ ‡ç­¾ **[åœ¨èŠ: iPhone 13]**ã€‚

------

### å››ã€ ä»£ç å¤§è‡´å®ç°æ€è·¯

è¿™æ˜¯ä¸€ä¸ªéå¸¸è½åœ°çš„å·¥ç¨‹åŒ–éœ€æ±‚ã€‚æˆ‘ä»¬å°†åŸºäº **Spring Boot + MyBatis-Plus** (åç«¯ä¸»æµ) å’Œ **Vue 3 + Composition API** (å‰ç«¯ä¸»æµ) æ¥ç»†åŒ–æ¯ä¸€å±‚çš„ä»£ç ã€‚

æˆ‘ä»¬å°†é‡ç‚¹å±•ç¤º **â€œå¦‚ä½•é€šè¿‡ä¸€æ¬¡å‘é€æ¶ˆæ¯ï¼ŒåŒæ—¶æ›´æ–°æ¶ˆæ¯è®°å½•å’Œä¼šè¯çŠ¶æ€â€** çš„æ ¸å¿ƒé€»è¾‘ã€‚

### ç¬¬ä¸€éƒ¨åˆ†ï¼šåç«¯å¼€å‘ (Server)

æŠ€æœ¯æ ˆå‡è®¾ï¼šSpring Boot, MyBatis-Plus, Lombok, MySQLã€‚

#### 1. Model (å®ä½“å±‚)

æˆ‘ä»¬éœ€è¦æ˜ å°„æ•°æ®åº“çš„ä¸¤å¼ è¡¨ï¼Œæ³¨æ„ JSON å­—æ®µçš„å¤„ç†ã€‚

Java

```
// Entity: ä¼šè¯åˆ—è¡¨
@Data
@TableName(value = "chat_conversations", autoResultMap = true)
public class ChatConversation {
    @TableId(type = IdType.AUTO)
    private Long id;
    
    private Long ownerId; // åˆ—è¡¨å½’å±è€…
    private Long peerId;  // èŠå¤©å¯¹è±¡
    
    // æ ¸å¿ƒï¼šå½“å‰ä¸Šä¸‹æ–‡å•†å“ID
    private Long relatedProductId;
    
    // æ ¸å¿ƒï¼šå•†å“å¿«ç…§ (ä½¿ç”¨MyBatis-Plusçš„JacksonTypeHandlerè‡ªåŠ¨è½¬JSON)
    @TableField(typeHandler = JacksonTypeHandler.class)
    private ProductSnapshot relatedProductInfo; 
    
    private String lastMsgContent;
    private Date lastMsgTime;
    private Integer unreadCount;
}

// Entity: æ¶ˆæ¯è®°å½•
@Data
@TableName(value = "chat_messages", autoResultMap = true)
public class ChatMessage {
    @TableId(type = IdType.AUTO)
    private Long id;
    
    private Long senderId;
    private Long receiverId;
    private Integer msgType; // 0:æ–‡æœ¬, 1:å›¾ç‰‡, 2:å•†å“å¡ç‰‡
    private String content;
    
    @TableField(typeHandler = JacksonTypeHandler.class)
    private Map<String, Object> extraData; // å­˜å•†å“è¯¦æƒ…ç­‰
    
    private Date createTime;
}

// DTO: å•†å“å¿«ç…§ç®€å•å¯¹è±¡
@Data
public class ProductSnapshot {
    private Long id;
    private String title;
    private String price;
    private String imgUrl;
}
```

#### 2. Dao / Mapper (æ•°æ®è®¿é—®å±‚)

è¿™é‡Œæœ€å…³é”®çš„æ˜¯å®ç° **Upsert (å­˜åœ¨å³æ›´æ–°ï¼Œä¸å­˜åœ¨å³æ’å…¥)** é€»è¾‘ï¼Œä¿è¯ä¼šè¯åˆ—è¡¨çš„é«˜æ•ˆæ›´æ–°ã€‚

Java

```
@Mapper
public interface ChatConversationMapper extends BaseMapper<ChatConversation> {

    // è‡ªå®šä¹‰ SQL å®ç°é«˜æ€§èƒ½ Upsert
    // å¦‚æœ owner+peer å­˜åœ¨ï¼Œåˆ™æ›´æ–°æœ€åæ¶ˆæ¯å’Œå…³è”å•†å“ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥
    @Update("INSERT INTO chat_conversations " +
            "(owner_id, peer_id, related_product_id, related_product_info, last_msg_content, last_msg_time, unread_count) " +
            "VALUES (#{ownerId}, #{peerId}, #{relatedProductId}, #{relatedProductInfo, typeHandler=...}, #{lastMsgContent}, #{lastMsgTime}, #{unreadCount}) " +
            "ON DUPLICATE KEY UPDATE " +
            "last_msg_content = VALUES(last_msg_content), " +
            "last_msg_time = VALUES(last_msg_time), " +
            "related_product_id = VALUES(related_product_id), " + // é‡ç‚¹ï¼šæ›´æ–°ä¸Šä¸‹æ–‡
            "related_product_info = VALUES(related_product_info), " +
            "unread_count = unread_count + VALUES(unread_count)") 
    void saveOrUpdateConversation(ChatConversation conversation);
}
```

#### 3. Service (ä¸šåŠ¡é€»è¾‘å±‚)

è¿™æ˜¯æ•´ä¸ªé€»è¾‘çš„å¿ƒè„ã€‚

Java

```
@Service
public class ChatService {

    @Autowired private ChatMessageMapper messageMapper;
    @Autowired private ChatConversationMapper conversationMapper;
    @Autowired private ProductService productService; // ç”¨äºè·å–å•†å“è¯¦æƒ…

    /**
     * å‘é€æ¶ˆæ¯æ ¸å¿ƒæ–¹æ³•
     * @param senderId å‘é€è€…
     * @param receiverId æ¥æ”¶è€…
     * @param content æ¶ˆæ¯å†…å®¹
     * @param currentContextProductId å‰ç«¯ä¼ æ¥çš„å½“å‰æ‚¬æµ®æ¡ID (å¯èƒ½ä¸ºç©º)
     */
    @Transactional(rollbackFor = Exception.class)
    public void sendMessage(Long senderId, Long receiverId, String content, Long currentContextProductId) {
        Date now = new Date();

        // 1. ä¿å­˜å…·ä½“æ¶ˆæ¯ (Messageè¡¨)
        ChatMessage msg = new ChatMessage();
        msg.setSenderId(senderId);
        msg.setReceiverId(receiverId);
        msg.setContent(content);
        msg.setCreateTime(now);
        // å¦‚æœæ˜¯å‘é€å•†å“å¡ç‰‡ç±»å‹ï¼ŒextraDataéœ€è¦å•ç‹¬å¤„ç†ï¼Œè¿™é‡Œçœç•¥
        messageMapper.insert(msg);

        // 2. å‡†å¤‡ä¸Šä¸‹æ–‡ä¿¡æ¯ (å¦‚æœå‰ç«¯å¸¦äº†productIdï¼Œå°±å»æŸ¥è¯¦æƒ…ç”¨äºæ›´æ–°ä¼šè¯å¿«ç…§)
        ProductSnapshot snapshot = null;
        if (currentContextProductId != null) {
            snapshot = productService.getSnapshot(currentContextProductId);
        }

        // 3. æ›´æ–°ã€å‘é€è€…ã€‘çš„ä¼šè¯åˆ—è¡¨
        ChatConversation selfConv = new ChatConversation();
        selfConv.setOwnerId(senderId);
        selfConv.setPeerId(receiverId);
        selfConv.setLastMsgContent(content);
        selfConv.setLastMsgTime(now);
        selfConv.setUnreadCount(0); // è‡ªå·±å‘çš„ï¼Œæœªè¯»æ•°å¢é‡ä¸º0
        selfConv.setRelatedProductId(currentContextProductId); // æ›´æ–°ä¸Šä¸‹æ–‡
        selfConv.setRelatedProductInfo(snapshot);
        conversationMapper.saveOrUpdateConversation(selfConv);

        // 4. æ›´æ–°ã€æ¥æ”¶è€…ã€‘çš„ä¼šè¯åˆ—è¡¨
        ChatConversation peerConv = new ChatConversation();
        peerConv.setOwnerId(receiverId);
        peerConv.setPeerId(senderId);
        peerConv.setLastMsgContent(content);
        peerConv.setLastMsgTime(now);
        peerConv.setUnreadCount(1); // å¯¹æ–¹æœªè¯» +1
        peerConv.setRelatedProductId(currentContextProductId); // å¯¹æ–¹åˆ—è¡¨ä¹ŸåŒæ­¥æ˜¾ç¤ºè¿™ä¸ªå•†å“
        peerConv.setRelatedProductInfo(snapshot);
        conversationMapper.saveOrUpdateConversation(peerConv);
        
        // 5. è°ƒç”¨ WebSocket æ¨é€ (çœç•¥)
    }
}
```

#### 4. Controller (æ¥å£å±‚)

Java

```
@RestController
@RequestMapping("/api/chat")
public class ChatController {
    @Autowired private ChatService chatService;

    // å‰ç«¯ç‚¹å‡»å‘é€æŒ‰é’®æ—¶è°ƒç”¨
    @PostMapping("/send")
    public Result sendMessage(@RequestBody SendMessageRequest req) {
        // req.getProductId() å°±æ˜¯å‰ç«¯æ‚¬æµ®æ¡å½“å‰çš„ ID
        chatService.sendMessage(
            UserContext.getUserId(), 
            req.getTargetId(), 
            req.getContent(), 
            req.getProductId() 
        );
        return Result.success();
    }
}
```

------

### ğŸ”µ ç¬¬äºŒéƒ¨åˆ†ï¼šå‰ç«¯å¼€å‘ (Vue 3 / WebApp)

æˆ‘ä»¬å°†æ‹†åˆ†ä¸º `ChatContextBar` ç»„ä»¶å’Œ `ChatPage` é¡µé¢ã€‚

#### 1. ç»„ä»¶ï¼šæ‚¬æµ®å•†å“æ¡ (components/ChatContextBar.vue)

è´Ÿè´£å±•ç¤ºï¼ŒåŒ…å«ä¸€ä¸ªå…³é—­æŒ‰é’®ã€‚

HTML

```
<template>
  <div v-if="product" class="product-float-bar">
    <img :src="product.imgUrl" class="thumb" />
    <div class="info">
      <div class="price">ï¿¥{{ product.price }}</div>
      <div class="title">å½“å‰æ²Ÿé€š: {{ product.title }}</div>
    </div>
    <button @click="$emit('send-link', product)">å‘é€é“¾æ¥</button>
    <button class="close-btn" @click="$emit('close')">Ã—</button>
  </div>
</template>

<script setup>
defineProps(['product']); // æ¥æ”¶çˆ¶ç»„ä»¶ä¼ æ¥çš„å•†å“å¯¹è±¡
defineEmits(['close', 'send-link']);
</script>

<style>
.product-float-bar {
  position: fixed; top: 44px; left: 0; right: 0;
  height: 60px; background: #fff; z-index: 99;
  display: flex; align-items: center; padding: 0 10px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
</style>
```

#### 2. é¡µé¢ï¼šèŠå¤©ä¸»é¡µ (views/ChatPage.vue)

æ ¸å¿ƒé€»è¾‘ï¼š`onMounted` æ—¶å†³å®šæ‚¬æµ®æ¡æ˜¾ç¤ºä»€ä¹ˆã€‚

HTML

```
<template>
  <div class="chat-page">
    <NavBar :title="targetUser.name" />

    <ChatContextBar 
      v-if="currentContextProduct" 
      :product="currentContextProduct" 
      @close="clearContext"
    />

    <div class="msg-list" :style="{ paddingTop: currentContextProduct ? '60px' : '0' }">
      <div v-for="msg in msgList" :key="msg.id">
        </div>
    </div>

    <div class="input-area">
      <input v-model="inputText" />
      <button @click="handleSend">å‘é€</button>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue';
import { useRoute } from 'vue-router';
import { getSessionHistory, getProductDetail, sendMsgApi } from '@/api/chat';

const route = useRoute();
const msgList = ref([]);
const currentContextProduct = ref(null); // æ ¸å¿ƒçŠ¶æ€ï¼šå½“å‰æ‚¬æµ®æ˜¾ç¤ºçš„å•†å“
const targetUserId = route.query.targetId;

// åˆå§‹åŒ–é€»è¾‘
onMounted(async () => {
  // A. è·å–å†å²èŠå¤©è®°å½• & ä¼šè¯å…ƒæ•°æ®
  const sessionData = await getSessionHistory(targetUserId);
  msgList.value = sessionData.messages;

  // B. [æ ¸å¿ƒåˆ¤æ–­é€»è¾‘] å†³å®šæ‚¬æµ®æ¡æ˜¾ç¤ºä»€ä¹ˆ
  const urlProductId = route.query.productId; // URLå‚æ•° (å¼ºæ„å›¾)
  const historyProduct = sessionData.conversation?.relatedProductInfo; // å†å²è®°å½• (å¼±æ„å›¾)

  if (urlProductId) {
    // åœºæ™¯1ï¼šä»å•†å“è¯¦æƒ…é¡µè·³è¿›æ¥çš„ -> ä¼˜å…ˆè¯·æ±‚æœ€æ–°å•†å“ä¿¡æ¯
    const productDetail = await getProductDetail(urlProductId);
    currentContextProduct.value = productDetail;
  } else if (historyProduct) {
    // åœºæ™¯2ï¼šä»åˆ—è¡¨è¿›æ¥çš„ï¼Œä½†æ•°æ®åº“é‡Œæœ‰è®°å½• -> æ¢å¤æ˜¾ç¤º
    currentContextProduct.value = historyProduct;
  }
  // åœºæ™¯3ï¼šéƒ½æ²¡æœ‰ -> currentContextProduct ä¸º nullï¼Œä¸æ¸²æŸ“
});

// æ¸…é™¤æ‚¬æµ®æ¡
const clearContext = () => {
  currentContextProduct.value = null;
};

// å‘é€æ¶ˆæ¯é€»è¾‘
const handleSend = async () => {
  if (!inputText.value) return;

  // æ„é€ å‘é€å‚æ•°
  const payload = {
    targetId: targetUserId,
    content: inputText.value,
    // [å…³é”®] å‘Šè¯‰åç«¯ï¼Œæˆ‘ç°åœ¨çœ‹ç€å“ªä¸ªå•†å“åœ¨èŠå¤©
    // å¦‚æœç”¨æˆ·å…³é—­äº†æ‚¬æµ®æ¡ï¼Œè¿™é‡Œå°±æ˜¯ nullï¼Œåç«¯ä¼šæ¸…ç©ºå…³è”
    productId: currentContextProduct.value ? currentContextProduct.value.id : null
  };

  await sendMsgApi(payload);
  
  // æœ¬åœ°è¿½åŠ æ¶ˆæ¯ä¸Šå±...
  inputText.value = '';
};
</script>
```

### æµç¨‹æ€»ç»“

1. **ç”¨æˆ·è¿›å…¥**ï¼šVue çš„ `onMounted` é’©å­æ ¹æ® `route.query.productId` ä¼˜å…ˆæ¸²æŸ“ `currentContextProduct`ã€‚
2. **ç”¨æˆ·æµè§ˆ**ï¼šæ­¤æ—¶åªæ˜¯å‰ç«¯ UI å±•ç¤ºï¼Œæ•°æ®åº“å°šæœªå˜æ›´ã€‚
3. **ç”¨æˆ·å‘é€**ï¼š
   - ç‚¹å‡»â€œå‘é€â€æŒ‰é’®ã€‚
   - Vue æå– `currentContextProduct.id` æ”¾å…¥ Payloadã€‚
   - è°ƒç”¨ API `/api/chat/send`ã€‚
4. **åç«¯å¤„ç†**ï¼š
   - `ChatController` æ¥æ”¶è¯·æ±‚ã€‚
   - `ChatService` è°ƒç”¨ `saveOrUpdateConversation`ã€‚
   - MyBatis æ‰§è¡Œ `ON DUPLICATE KEY UPDATE`ï¼Œå°† `related_product_id` å†™å…¥æ•°æ®åº“ã€‚
5. **ç»“æœ**ï¼šä¸‹æ¬¡ä»åˆ—è¡¨é¡µè¿›æ¥ï¼Œå› ä¸ºæ•°æ®åº“å·²æ›´æ–°ï¼Œå³ä½¿ç”¨æˆ·æ²¡å¸¦ URL å‚æ•°ï¼Œä¹Ÿä¼šè‡ªåŠ¨æ˜¾ç¤ºè¯¥å•†å“æ‚¬æµ®æ¡ã€‚

# åŒå‘è¯„ä»·æœºåˆ¶

è¿™æ˜¯ä¸€ä¸ªåŸºäºä½ ç°æœ‰é¡¹ç›®ä»£ç çš„å…·ä½“å®ç°è®¡åˆ’ã€‚æˆ‘ä»¬å°†åˆ†ä¸ºæ•°æ®åº“ã€åç«¯ï¼ˆSpring Bootï¼‰å’Œå‰ç«¯ï¼ˆVue.jsï¼‰ä¸‰ä¸ªéƒ¨åˆ†è¿›è¡Œæ‰©å±•ã€‚

### 1. æ•°æ®åº“æ‰©å±• (Database)

æˆ‘ä»¬éœ€è¦æ–°å»ºä¸€å¼ è¡¨æ¥å­˜å‚¨è¯„ä»·è®°å½•ï¼Œå¹¶åœ¨ç”¨æˆ·è¡¨ä¸­æ·»åŠ ä¿¡èª‰åˆ†å­—æ®µã€‚

**SQL è„šæœ¬:**

```sql
USE `second_hand_trading`;

/* 1. æ–°å¢è¯„ä»·è¡¨ */
DROP TABLE IF EXISTS `sh_evaluation`;
CREATE TABLE `sh_evaluation` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®',
  `order_id` bigint(20) NOT NULL COMMENT 'å…³è”è®¢å•ID',
  `evaluator_id` bigint(20) NOT NULL COMMENT 'è¯„ä»·äººç”¨æˆ·ID',
  `target_id` bigint(20) NOT NULL COMMENT 'è¢«è¯„ä»·äººç”¨æˆ·ID',
  `score` int(11) NOT NULL DEFAULT 5 COMMENT 'è¯„åˆ†(1-5åˆ†)',
  `content` varchar(512) DEFAULT NULL COMMENT 'è¯„ä»·å†…å®¹',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'è¯„ä»·æ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_order_evaluator` (`order_id`, `evaluator_id`), /* è”åˆç´¢å¼•ï¼Œé˜²æ­¢é‡å¤è¯„ä»· */
  KEY `idx_target_id` (`target_id`) /* ç”¨äºæŸ¥è¯¢æŸäººæ”¶åˆ°çš„è¯„ä»· */
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='è®¢å•è¯„ä»·è¡¨';

/* 2. ä¿®æ”¹ç”¨æˆ·è¡¨ï¼Œå¢åŠ ä¿¡èª‰åˆ† */
/* åˆå§‹ä¿¡èª‰åˆ†è®¾ä¸º100ï¼Œæˆ–è€…ä½ å¯ä»¥è®¾ä¸º0ä»å¤´ç§¯ç´¯ */
ALTER TABLE `sh_user` 
ADD COLUMN `credit_score` int(11) NOT NULL DEFAULT 100 COMMENT 'ç”¨æˆ·ä¿¡èª‰åˆ†';

```

---

### 2. åç«¯å®ç° (Backend - Spring Boot)

åŸºäº `com.second.hand.trading.server` åŒ…ç»“æ„è¿›è¡Œæ‰©å±•ã€‚

#### 2.1 Model å±‚ (`model/EvaluationModel.java`)

```java
package com.second.hand.trading.server.model;

import java.io.Serializable;
import java.util.Date;
import lombok.Data; // å‡è®¾ä½ ç”¨äº†lombokï¼Œå¦‚æœæ²¡æœ‰åˆ™æ‰‹åŠ¨ç”Ÿæˆgetter/setter

@Data
public class EvaluationModel implements Serializable {
    private Long id;
    private Long orderId;
    private Long evaluatorId;
    private Long targetId;
    private Integer score;
    private String content;
    private Date createTime;
    
    // æ‰©å±•å­—æ®µï¼Œç”¨äºå‰ç«¯æ˜¾ç¤ºè¯„ä»·äººä¿¡æ¯
    private UserModel evaluator; 
}

```

#### 2.2 DAO å±‚

**`dao/EvaluationDao.java` (Interface)**

```java
package com.second.hand.trading.server.dao;

import com.second.hand.trading.server.model.EvaluationModel;
import org.apache.ibatis.annotations.Param;
import java.util.List;

public interface EvaluationDao {
    int insert(EvaluationModel record);
    
    // æŸ¥è¯¢è¯¥è®¢å•æ˜¯å¦å·²è¢«æŸç”¨æˆ·è¯„ä»·è¿‡
    int countByOrderAndEvaluator(@Param("orderId") Long orderId, @Param("evaluatorId") Long evaluatorId);
    
    // è·å–æŸç”¨æˆ·æ”¶åˆ°çš„æ‰€æœ‰è¯„ä»·
    List<EvaluationModel> selectByTargetId(Long targetId);
}

```

**`resources/mapper/EvaluationDao.xml`**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.second.hand.trading.server.dao.EvaluationDao">
  
  <insert id="insert" parameterType="com.second.hand.trading.server.model.EvaluationModel">
    INSERT INTO sh_evaluation (order_id, evaluator_id, target_id, score, content, create_time)
    VALUES (#{orderId}, #{evaluatorId}, #{targetId}, #{score}, #{content}, NOW())
  </insert>

  <select id="countByOrderAndEvaluator" resultType="java.lang.Integer">
    SELECT COUNT(1) FROM sh_evaluation 
    WHERE order_id = #{orderId} AND evaluator_id = #{evaluatorId}
  </select>

  <select id="selectByTargetId" resultType="com.second.hand.trading.server.model.EvaluationModel">
    SELECT e.*, u.nickname as 'evaluator.nickname', u.avatar as 'evaluator.avatar'
    FROM sh_evaluation e
    LEFT JOIN sh_user u ON e.evaluator_id = u.id
    WHERE e.target_id = #{targetId}
    ORDER BY e.create_time DESC
  </select>
</mapper>

```

#### 2.3 Service å±‚

æˆ‘ä»¬éœ€è¦å¤„ç†æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼šä¿å­˜è¯„ä»· + æ›´æ–°ä¿¡èª‰åˆ†ã€‚

**`service/EvaluationService.java`**

```java
package com.second.hand.trading.server.service;

import com.second.hand.trading.server.model.EvaluationModel;
import java.util.List;

public interface EvaluationService {
    boolean addEvaluation(EvaluationModel evaluationModel);
    List<EvaluationModel> getUserEvaluations(Long userId);
}

```

**`service/impl/EvaluationServiceImpl.java`**

```java
package com.second.hand.trading.server.service.impl;

import com.second.hand.trading.server.dao.EvaluationDao;
import com.second.hand.trading.server.dao.UserDao;
import com.second.hand.trading.server.dao.OrderDao;
import com.second.hand.trading.server.model.EvaluationModel;
import com.second.hand.trading.server.model.OrderModel;
import com.second.hand.trading.server.model.UserModel;
import com.second.hand.trading.server.service.EvaluationService;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import jakarta.annotation.Resource;
import java.util.List;

@Service
public class EvaluationServiceImpl implements EvaluationService {

    @Resource
    private EvaluationDao evaluationDao;
    @Resource
    private UserDao userDao;
    @Resource
    private OrderDao orderDao;

    @Override
    @Transactional(rollbackFor = Exception.class)
    public boolean addEvaluation(EvaluationModel evaluationModel) {
        // 1. æ ¡éªŒæ˜¯å¦é‡å¤è¯„ä»·
        int count = evaluationDao.countByOrderAndEvaluator(evaluationModel.getOrderId(), evaluationModel.getEvaluatorId());
        if (count > 0) {
            throw new RuntimeException("æ‚¨å·²è¯„ä»·è¿‡è¯¥è®¢å•");
        }
        
        // 2. æ ¡éªŒè®¢å•çŠ¶æ€ (å‡è®¾çŠ¶æ€3ä¸ºäº¤æ˜“å®Œæˆ)
        OrderModel order = orderDao.selectByPrimaryKey(evaluationModel.getOrderId());
        if (order == null || order.getOrderStatus() != 3) {
             throw new RuntimeException("è®¢å•æœªå®Œæˆï¼Œæ— æ³•è¯„ä»·");
        }

        // 3. æ’å…¥è¯„ä»·
        if (evaluationDao.insert(evaluationModel) == 1) {
            // 4. è®¡ç®—å¹¶æ›´æ–°è¢«è¯„ä»·äººçš„ä¿¡èª‰åˆ†
            updateCreditScore(evaluationModel.getTargetId(), evaluationModel.getScore());
            return true;
        }
        return false;
    }

    private void updateCreditScore(Long userId, Integer newScore) {
        UserModel user = userDao.selectByPrimaryKey(userId);
        if (user != null) {
            // ç®€å•ç®—æ³•ï¼šå¥½è¯„(4-5åˆ†)+2åˆ†ï¼Œä¸­è¯„(3åˆ†)0åˆ†ï¼Œå·®è¯„(1-2åˆ†)-2åˆ†
            // å®é™…ä¸Šä½ å¯ä»¥åšæ›´å¤æ‚çš„åŠ æƒå¹³å‡
            int currentScore = user.getCreditScore() == null ? 100 : user.getCreditScore();
            int change = 0;
            if (newScore >= 4) change = 2;
            else if (newScore <= 2) change = -2;
            
            int finalScore = Math.max(0, Math.min(999, currentScore + change)); // é™åˆ¶èŒƒå›´ 0-999
            
            user.setCreditScore(finalScore);
            userDao.updateByPrimaryKeySelective(user); // éœ€ç¡®ä¿UserDaoæœ‰æ›´æ–°credit_scoreçš„SQL
        }
    }

    @Override
    public List<EvaluationModel> getUserEvaluations(Long userId) {
        return evaluationDao.selectByTargetId(userId);
    }
}

```

**æ³¨æ„**: ä½ éœ€è¦æ£€æŸ¥ `UserDao.xml` ä¸­çš„ `updateByPrimaryKeySelective`ï¼Œç¡®ä¿å®ƒåŒ…å«äº† `<if test="creditScore != null">credit_score = #{creditScore},</if>`ã€‚

#### 2.4 Controller å±‚ (`controller/EvaluationController.java`)

```java
package com.second.hand.trading.server.controller;

import com.second.hand.trading.server.model.EvaluationModel;
import com.second.hand.trading.server.service.EvaluationService;
import com.second.hand.trading.server.vo.ResultVo;
import org.springframework.web.bind.annotation.*;
import jakarta.annotation.Resource;
import java.util.List;

@RestController
@RequestMapping("/evaluation")
public class EvaluationController {

    @Resource
    private EvaluationService evaluationService;

    @PostMapping("/add")
    public ResultVo addEvaluation(@RequestBody EvaluationModel evaluationModel, @CookieValue("shUserId") String shUserId) {
        // ç®€å•çš„å®‰å…¨æ ¡éªŒï¼šç¡®ä¿å½“å‰ç™»å½•ç”¨æˆ·å°±æ˜¯è¯„ä»·äºº
        if (!shUserId.equals(String.valueOf(evaluationModel.getEvaluatorId()))) {
             return ResultVo.fail("éæ³•æ“ä½œ");
        }
        try {
            if (evaluationService.addEvaluation(evaluationModel)) {
                return ResultVo.success("è¯„ä»·æˆåŠŸ");
            }
            return ResultVo.fail("è¯„ä»·å¤±è´¥");
        } catch (Exception e) {
            return ResultVo.fail(e.getMessage());
        }
    }

    @GetMapping("/list")
    public ResultVo getList(@RequestParam("userId") Long userId) {
        List<EvaluationModel> list = evaluationService.getUserEvaluations(userId);
        return ResultVo.success(list);
    }
}

```

---

### 3. å‰ç«¯å®ç° (Frontend - Vue.js)

#### 3.1 API å®šä¹‰ (`src/api/index.js`)

å¢åŠ è¯„ä»·ç›¸å…³çš„æ¥å£è¯·æ±‚ï¼š

```javascript
// ... existing code ...

// æäº¤è¯„ä»·
export const addEvaluation = query => {
    return request({
        url: '/evaluation/add',
        method: 'post',
        data: query
    });
};

// è·å–æŸç”¨æˆ·çš„è¯„ä»·åˆ—è¡¨ï¼ˆç”¨äºä¸ªäººä¸»é¡µæˆ–å•†å“è¯¦æƒ…é¡µï¼‰
export const getEvaluationList = query => {
    return request({
        url: '/evaluation/list',
        method: 'get',
        params: query
    });
};

```

#### 3.2 è®¢å•é¡µä¿®æ”¹ (`src/components/page/order.vue`)

åœ¨è®¢å•åˆ—è¡¨ä¸­ï¼Œå¦‚æœè®¢å•çŠ¶æ€ä¸ºâ€œå·²å®Œæˆâ€ï¼Œæ˜¾ç¤ºâ€œè¯„ä»·â€æŒ‰é’®ã€‚

```html
<template slot-scope="scope">
    <el-button type="primary" size="small" @click="handleDetail(scope.row)">æŸ¥çœ‹è¯¦æƒ…</el-button>
    
    <el-button 
        v-if="scope.row.orderStatus === 3" 
        type="warning" 
        size="small" 
        @click="openEvaluateModal(scope.row)">
        è¯„ä»·
    </el-button>
</template>

<el-dialog title="è¯„ä»·è®¢å•" :visible.sync="evaluateVisible" width="30%">
    <el-form :model="evaluateForm">
        <el-form-item label="è¯„åˆ†">
            <el-rate v-model="evaluateForm.score" show-text></el-rate>
        </el-form-item>
        <el-form-item label="è¯„ä»·å†…å®¹">
            <el-input type="textarea" v-model="evaluateForm.content" placeholder="è¯·è¾“å…¥æ‚¨çš„è¯„ä»·..."></el-input>
        </el-form-item>
    </el-form>
    <span slot="footer" class="dialog-footer">
        <el-button @click="evaluateVisible = false">å– æ¶ˆ</el-button>
        <el-button type="primary" @click="submitEvaluation">ç¡® å®š</el-button>
    </span>
</el-dialog>

```

```javascript
// script éƒ¨åˆ†
import { addEvaluation } from '../../api/index';

export default {
    data() {
        return {
            evaluateVisible: false,
            evaluateForm: {
                orderId: '',
                evaluatorId: '', // ä»æœ¬åœ°å­˜å‚¨æˆ–Vuexè·å–å½“å‰ç”¨æˆ·ID
                targetId: '',    // ä»è®¢å•ä¿¡æ¯ä¸­è·å–ï¼šå¦‚æœæ˜¯ä¹°å®¶ï¼Œåˆ™æ˜¯å–å®¶IDï¼›åä¹‹äº¦ç„¶
                score: 5,
                content: ''
            },
            currentOrder: null
        }
    },
    methods: {
        openEvaluateModal(row) {
            this.currentOrder = row;
            this.evaluateForm.orderId = row.id;
            this.evaluateForm.evaluatorId = JSON.parse(localStorage.getItem("userInfo")).id; 
            // é€»è¾‘åˆ¤æ–­ï¼šå¦‚æœæˆ‘æ˜¯ä¹°å®¶(row.userId == æˆ‘)ï¼Œtargetå°±æ˜¯å–å®¶(row.idleItem.userId)
            // éœ€è¦åç«¯OrderModelè¿”å›å®Œæ•´çš„IdleItemä¿¡æ¯
            if (row.userId == this.evaluateForm.evaluatorId) {
                this.evaluateForm.targetId = row.idleItem.userId;
            } else {
                this.evaluateForm.targetId = row.userId;
            }
            this.evaluateVisible = true;
        },
        submitEvaluation() {
            addEvaluation(this.evaluateForm).then(res => {
                if(res.code === 200 || res.code === 0) { // æ ¹æ®ä½ çš„ResultVoæˆåŠŸç 
                    this.$message.success('è¯„ä»·æˆåŠŸ');
                    this.evaluateVisible = false;
                } else {
                    this.$message.error(res.msg);
                }
            });
        }
    }
}

```

#### 3.3 ä¸ªäººä¸­å¿ƒå±•ç¤ºä¿¡èª‰åˆ† (`src/components/page/me.vue`)

åœ¨ç”¨æˆ·ä¿¡æ¯åŒºåŸŸå±•ç¤º `creditScore`ã€‚

```html
<div class="user-info">
    <div>æ˜µç§°: {{ userInfo.nickname }}</div>
    <div>
        ä¿¡èª‰åˆ†: 
        <el-tag type="success" v-if="userInfo.creditScore >= 100">{{ userInfo.creditScore }} (æå¥½)</el-tag>
        <el-tag type="warning" v-else-if="userInfo.creditScore >= 80">{{ userInfo.creditScore }} (è‰¯å¥½)</el-tag>
        <el-tag type="danger" v-else>{{ userInfo.creditScore }} (ä¸€èˆ¬)</el-tag>
    </div>
</div>

```

**æ³¨æ„**: ç™»å½•æ¥å£è¿”å›çš„ `userInfo` å¯¹è±¡ä¸­ç°åœ¨åŒ…å« `creditScore` äº†å—ï¼Ÿå¦‚æœæ²¡æœ‰ï¼Œä½ éœ€è¦æ£€æŸ¥ `UserController` ä¸­çš„ç™»å½•æˆ–è·å–ä¿¡æ¯æ¥å£ï¼Œç¡®ä¿å®ƒè¿”å›äº†æ•°æ®åº“ä¸­æ–°å¢çš„å­—æ®µã€‚

#### 3.4 é—²ç½®è¯¦æƒ…é¡µå±•ç¤ºå–å®¶ä¿¡èª‰ (`src/components/page/idle-details.vue`)

åœ¨æ˜¾ç¤ºå–å®¶ä¿¡æ¯çš„åœ°æ–¹ï¼ˆé€šå¸¸åœ¨ä¾§è¾¹æ æˆ–æ ‡é¢˜ä¸‹æ–¹ï¼‰ï¼Œè°ƒç”¨è·å–ç”¨æˆ·ä¿¡æ¯æ¥å£æˆ–è¯„ä»·åˆ—è¡¨æ¥å£æ¥å±•ç¤ºã€‚

```javascript
// åœ¨è·å–é—²ç½®è¯¦æƒ…åï¼ŒidleItem.user åº”è¯¥åŒ…å«å–å®¶ä¿¡æ¯
// å¦‚æœ Userå®ä½“å·²ç»æ›´æ–°ï¼Œè¿™é‡Œç›´æ¥æ˜¾ç¤ºå³å¯
<div>å–å®¶ä¿¡èª‰: {{ idleItem.user.creditScore }}</div>

```

### æ€»ç»“

1. **æ•°æ®åº“**: å¿…é¡»æ‰§è¡Œ `ALTER TABLE` å’Œ `CREATE TABLE`ã€‚
2. **åç«¯**: `UserModel` å¿…é¡»å¯¹åº”æ•°æ®åº“å­—æ®µã€‚`EvaluationService` è´Ÿè´£è®¡ç®—åˆ†æ•°é€»è¾‘ã€‚
3. **å‰ç«¯**: ä¸»è¦æ˜¯äº¤äº’å…¥å£ï¼ˆè®¢å•é¡µï¼‰å’Œå±•ç¤ºå‡ºå£ï¼ˆä¸ªäººé¡µ/è¯¦æƒ…é¡µï¼‰ã€‚

è¿™ä¸ªè®¡åˆ’æœ€å°åŒ–äº†å¯¹ç°æœ‰æ ¸å¿ƒäº¤æ˜“é€»è¾‘çš„ä¾µå…¥ï¼Œä¸»è¦æ˜¯åœ¨äº¤æ˜“å®Œæˆåå¢åŠ äº†ä¸€ä¸ªåç»­æ­¥éª¤ã€‚

---

## å®æ–½è¿›åº¦å›é¡¾ï¼ˆ2026-01-07ï¼‰

æœ¬è½®è¿­ä»£å·²æŒ‰ä¸Šè¿°æ–¹æ¡ˆå®ŒæˆåŒå‘è¯„ä»·çš„ç«¯åˆ°ç«¯è½åœ°ï¼Œå…³é”®æˆæœå¦‚ä¸‹ï¼š

- **æ•°æ®åº“å‡çº§**ï¼šè¯„ä»·è¡¨ä¸ä¿¡èª‰åˆ†å­—æ®µå·²æ•´ç†è¿›åˆå§‹åŒ–è„šæœ¬ï¼Œå‚è§ [second_hand_trading.sql](second_hand_trading.sql)ã€‚ä¸Šçº¿æ—¶æ‰§è¡Œè„šæœ¬å³å¯åˆ›å»º `sh_evaluation` å¹¶ä¸º `sh_user.credit_score` å¡«å……é»˜è®¤å€¼ã€‚
- **åç«¯èƒ½åŠ›**ï¼šæ–°å¢è¯„ä»·æ¨¡å‹ã€Mapperã€Service ä¸ Controllerï¼Œå®Œæ•´ä»£ç ä½äº [Server/src/main/java/com/second/hand/trading/server/controller/EvaluationController.java](Server/src/main/java/com/second-hand-trading/server/controller/EvaluationController.java)ã€[Server/src/main/java/com/second/hand/trading/server/service/impl/EvaluationServiceImpl.java](Server/src/main/java/com/second-hand-trading/server/service/impl/EvaluationServiceImpl.java) ä»¥åŠé…å¥— Mapperã€Model ç›®å½•ã€‚`EvaluationServiceImpl` è´Ÿè´£æ ¡éªŒè®¢å•åŒæ–¹ã€é™åˆ¶é‡å¤æäº¤ï¼Œå¹¶æŒ‰å¹³å‡åˆ†åˆ·æ–°ä¿¡èª‰åˆ†ã€‚
- **æ¥å£ç¼–æ’**ï¼šæä¾› `POST /evaluation/add`ã€`GET /evaluation/order`ã€`GET /evaluation/order/all`ã€`GET /evaluation/given`ã€`GET /evaluation/received` ç­‰æ¥å£ï¼Œç»Ÿä¸€é€šè¿‡ `ResultVo` è¿”å›çŠ¶æ€ç ä¸æ•°æ®ï¼Œå‰ç«¯å¯ç›´æ¥åŒºåˆ†æˆåŠŸ/å¤±è´¥ã€‚
- **æ•°æ®æ ¡éªŒ**ï¼šæ¥å£å¤ç”¨ `ErrorMsg.REPEAT_COMMIT_ERROR` ä¸ `ErrorMsg.PARAM_ERROR`ï¼Œé¿å…é‡å¤è¯„ä»·åŠéæ³•è®¿é—®ï¼Œç¡®ä¿ä»…è®¢å•ä¹°å–åŒæ–¹å¯è®¿é—®è¯„ä»·é€šé“ã€‚
- **è‡ªåŠ¨åŒ–éªŒè¯**ï¼šåœ¨ [Server/src/test/java/com/second/hand/trading/server/service/EvaluationServiceImplTest.java](Server/src/test/java/com/second-hand-trading/server/service/EvaluationServiceImplTest.java) è¡¥å…… Mockito å•å…ƒæµ‹è¯•ï¼Œè¦†ç›–è¯„åˆ†è£å‰ªã€ä¿¡èª‰åˆ†åˆ·æ–°å’Œè¶Šæƒæ‹¦æˆªã€‚
- **å‰ç«¯æ”¹é€ **ï¼š
    - API å°è£…é›†ä¸­åœ¨ [WebApp/src/api/index.js](WebApp/src/api/index.js)ï¼Œç»Ÿä¸€è°ƒç”¨æ–°æ¥å£ã€‚
    - è®¢å•è¯¦æƒ…é¡µ [WebApp/src/components/page/order.vue](WebApp/src/components/page/order.vue) æä¾›è¯„ä»·å¼¹çª—ä¸è¯„ä»·åˆ—è¡¨ï¼Œå¹¶åœ¨ç¡®è®¤æ”¶è´§åæç¤ºå¡«å†™ã€‚è‹¥å½“å‰ç”¨æˆ·æ˜¯è¯„ä»·ç›®æ ‡ï¼Œä¼šè‡ªåŠ¨åˆ·æ–°ç”¨æˆ·ä¿¡æ¯ä»¥åŒæ­¥æœ€æ–°ä¿¡èª‰åˆ†ã€‚
    - ä¸ªäººä¸­å¿ƒé¡µ [WebApp/src/components/page/me.vue](WebApp/src/components/page/me.vue) æ–°å¢ä¿¡èª‰åˆ†å±•ç¤ºåŠâ€œæ”¶åˆ°çš„è¯„ä»· / æˆ‘çš„è¯„ä»·â€æ ‡ç­¾é¡µï¼Œä¾¿äºæŸ¥çœ‹å†å²è¯„ä»·è®°å½•ã€‚

åç»­è‹¥è¦æ‰©å±•ç³»ç»Ÿé€šçŸ¥ã€åå°ç®¡ç†æˆ–è¯„ä»·ä»²è£ï¼Œå¯åœ¨è¯¥åŸºç¡€ç»§ç»­è¿­ä»£ã€‚